/*!
*****************************************************************************
** \file        software/linux/kernel/drv/sensors/sp2307/sp2307.c
**
** \version     $Id: sp2307_ex.c 10876 2017-02-14 02:42:49Z hehuali $
**
** \brief
**
** \attention   THIS SAMPLE CODE IS PROVIDED AS IS. GOKE MICROELECTRONICS
**              ACCEPTS NO RESPONSIBILITY OR LIABILITY FOR ANY ERRORS OR
**              OMMISSIONS
**
** (C) Copyright 2012-2015 by GOKE MICROELECTRONICS CO.,LTD
**
*****************************************************************************
*/
#include <linux/module.h>
#include <linux/delay.h>
#include <linux/slab.h>
#include "gk_sensor.h"
#include "sp2307_pri.h"

#define SET_REG_BY_VSYNC
#ifdef SET_REG_BY_VSYNC
#define SET_SHUTTER_BY_VSYNC
#endif

typedef struct
{
    int sub_id;
    //GK_Vi_SensorT api;
#ifdef SET_REG_BY_VSYNC
    int sp2307_adc_ch;
    //int sp2307_reg_fd;  //page1
    int sp2307_reg_24;  //agc
    int sp2307_reg_39;  //dgc

    //int sp2307_last_reg_fd;
    int sp2307_last_reg_24;
    int sp2307_last_reg_39;

    u8 sp2307_mirror_need_up;
    int sp2307_crop_ver_l;
    int sp2307_crop_hor_l;
    int sp2307_mirror_flip;

#ifdef SET_SHUTTER_BY_VSYNC

    int sp2307_shutter_ch;
    int sp2307_reg_exp_time_h;
    int sp2307_reg_exp_time_l;

    int sp2307_last_reg_exp_time_h;
    int sp2307_last_reg_exp_time_l;
#endif
#endif
    int fps_set_flag;
    int fps_frame_len_bak; //default: 20fps   //900: 25fps
}GK_Vi_Sensor_SP2307T;
//*****************************************************************************
//*****************************************************************************
//** Local structures
//*****************************************************************************
//*****************************************************************************
#define SP2307_GAIN_ROWS            577
typedef struct sp2307_gain_table
{
    u32 db_value;
    struct
    {
        //u8 SP2307_REG_FD;  //page set.
        u8 SP2307_REG_24;  //agc.
		u8 SP2307_REG_39;  //dgc.
    }regs;
}sp2307_gain_table_s;


//*****************************************************************************
//*****************************************************************************
//** Global Data
//*****************************************************************************
//*****************************************************************************

//*****************************************************************************
//*****************************************************************************
//** Local Data
//*****************************************************************************
//*****************************************************************************
static int sp2307_get_vblank_time(int handle, GK_Vi_SensorT* sensor_extern, u32* ptime, u32 extclk, u32 pclk);
static int sp2307_set_agc_db(int handle, GK_Vi_SensorT* sensor_extern, s32 agc_db);
static int sp2307_set_shutter_time(int handle, GK_Vi_SensorT* sensor_extern, u32 shutter_time, u32 extclk, u32 pclk);
static int sp2307_set_fps(int handle, GK_Vi_SensorT* sensor_extern, u32 fps, u32 extclk, u32 pclk);
static int sp2307_set_mirror_mode(int handle, GK_Vi_SensorT* sensor_extern, u32 mirr_mode);
static int sp2307_set_update_reg(int handle, GK_Vi_SensorT* sensor_extern);
static GK_Vi_SensorT sp2307_dev;
#if 0

static GK_Vi_Sensor_SP2307T sp2307 =
{
    .api =
    {
        .sensor_id                = GK_VI_SENSOR_SP2307,
        .length                   = sizeof(GK_Vi_Sensor_SP2307T),
        .sensor_get_vblank_time   = sp2307_get_vblank_time,
        .sensor_set_shutter_time  = sp2307_set_shutter_time,
        .sensor_set_fps           = sp2307_set_fps,
        .sensor_set_agc_db        = sp2307_set_agc_db,
        .sensor_set_mirror_mode   = sp2307_set_mirror_mode,
        .sensor_set_update_reg    = sp2307_set_update_reg,
    },
#ifdef SET_REG_BY_VSYNC
    .sp2307_adc_ch = 0,
    //.sp2307_reg_fd = 0x01,  //page1
    .sp2307_reg_24 = 0x20,  //agc: 1x: 2x in fact.
    .sp2307_reg_39 = 0x08,  //dgc: 1.0x

    //.sp2307_last_reg_fd = 0xffffffff,
    .sp2307_last_reg_24 = 0xffffffff,
    .sp2307_last_reg_39 = 0xffffffff,

    .sp2307_mirror_need_up  = 0x00,
    .sp2307_crop_ver_l      = 0x02,
    .sp2307_crop_hor_l      = 0x03,
    .sp2307_mirror_flip     = 0x00,

#ifdef SET_SHUTTER_BY_VSYNC

    .sp2307_shutter_ch = 0,
    .sp2307_reg_exp_time_h = 0,
    .sp2307_reg_exp_time_l = 0,

    .sp2307_last_reg_exp_time_h = 0xffffffff,
    .sp2307_last_reg_exp_time_l = 0xffffffff,
#endif
#endif
    .fps_set_flag       = 0,
    .fps_frame_len_bak  = 1117, //default: 30fps   //1361: 25fps  //valid_v alway 1117.
};
#endif

const sp2307_gain_table_s SP2307_GLOBAL_GAIN_TABLE[SP2307_GAIN_ROWS] =
{
    	//infact, (0x20,0x08)is 2x, gain of sp2307 couldn't be less than 2x.
    	//db_tbl      again  dgain    //multiple     //db_value   //db_lut
        {0x00000000, {0x20, 0x08,}},  //1.000000,    //0.000000   //0x00000000
		{0x008657c9, {0x21, 0x08,}},  //1.062500,    //0.524777   //0x008657c9
		{0x0105013a, {0x22, 0x08,}},  //1.125000,    //1.019550   //0x0105013a
		{0x017cd110, {0x23, 0x08,}},  //1.187500,    //1.487565   //0x017cd110
		{0x01ee7b47, {0x24, 0x08,}},  //1.250000,    //1.931569   //0x01ee7b47
		{0x025a997c, {0x25, 0x08,}},  //1.312500,    //2.353905   //0x025a997c
		{0x02c1afdd, {0x26, 0x08,}},  //1.375000,    //2.756590   //0x02c1afdd
		{0x032430f0, {0x27, 0x08,}},  //1.437500,    //3.141372   //0x032430f0
		{0x0382809d, {0x28, 0x08,}},  //1.500000,    //3.509775   //0x0382809d
		{0x03dcf68e, {0x29, 0x08,}},  //1.562500,    //3.863137   //0x03dcf68e
		{0x0433e01a, {0x2a, 0x08,}},  //1.625000,    //4.202638   //0x0433e01a
		{0x048781d8, {0x2b, 0x08,}},  //1.687500,    //4.529325   //0x048781d8
		{0x04d818df, {0x2c, 0x08,}},  //1.750000,    //4.844130   //0x04d818df
		{0x0525dbda, {0x2d, 0x08,}},  //1.812500,    //5.147886   //0x0525dbda
		{0x0570fbe4, {0x2e, 0x08,}},  //1.875000,    //5.441344   //0x0570fbe4
		{0x05b9a541, {0x2f, 0x08,}},  //1.937500,    //5.725178   //0x05b9a541
		{0x06000000, {0x30, 0x08,}},  //2.000000,    //6.000000   //0x06000000
		{0x0644307a, {0x31, 0x08,}},  //2.062500,    //6.266365   //0x0644307a
		{0x068657c9, {0x32, 0x08,}},  //2.125000,    //6.524777   //0x068657c9
		{0x06c69426, {0x33, 0x08,}},  //2.187500,    //6.775698   //0x06c69426
		{0x0705013a, {0x34, 0x08,}},  //2.250000,    //7.019550   //0x0705013a
		{0x0741b86a, {0x35, 0x08,}},  //2.312500,    //7.256720   //0x0741b86a
		{0x077cd110, {0x36, 0x08,}},  //2.375000,    //7.487565   //0x077cd110
		{0x07b660b8, {0x37, 0x08,}},  //2.437500,    //7.712413   //0x07b660b8
		{0x07ee7b47, {0x38, 0x08,}},  //2.500000,    //7.931569   //0x07ee7b47
		{0x0825332b, {0x39, 0x08,}},  //2.562500,    //8.145312   //0x0825332b
		{0x085a997c, {0x3a, 0x08,}},  //2.625000,    //8.353905   //0x085a997c
		{0x088ebe1f, {0x3b, 0x08,}},  //2.687500,    //8.557589   //0x088ebe1f
		{0x08c1afdd, {0x3c, 0x08,}},  //2.750000,    //8.756590   //0x08c1afdd
		{0x08f37c81, {0x3d, 0x08,}},  //2.812500,    //8.951119   //0x08f37c81
		{0x092430f0, {0x3e, 0x08,}},  //2.875000,    //9.141372   //0x092430f0
		{0x0953d935, {0x3f, 0x08,}},  //2.937500,    //9.327533   //0x0953d935
		{0x0982809d, {0x40, 0x08,}},  //3.000000,    //9.509775   //0x0982809d
		{0x09b031be, {0x41, 0x08,}},  //3.062500,    //9.688259   //0x09b031be
		{0x09dcf68e, {0x42, 0x08,}},  //3.125000,    //9.863137   //0x09dcf68e
		{0x0a08d867, {0x43, 0x08,}},  //3.187500,    //10.034552  //0x0a08d867
		{0x0a33e01a, {0x44, 0x08,}},  //3.250000,    //10.202638  //0x0a33e01a
		{0x0a5e15f8, {0x45, 0x08,}},  //3.312500,    //10.367523  //0x0a5e15f8
		{0x0a8781d8, {0x46, 0x08,}},  //3.375000,    //10.529325  //0x0a8781d8
		{0x0ab02b24, {0x47, 0x08,}},  //3.437500,    //10.688158  //0x0ab02b24
		{0x0ad818df, {0x48, 0x08,}},  //3.500000,    //10.844130  //0x0ad818df
		{0x0aff51ae, {0x49, 0x08,}},  //3.562500,    //10.997340  //0x0aff51ae
		{0x0b25dbda, {0x4a, 0x08,}},  //3.625000,    //11.147886  //0x0b25dbda
		{0x0b4bbd5e, {0x4b, 0x08,}},  //3.687500,    //11.295858  //0x0b4bbd5e
		{0x0b70fbe4, {0x4c, 0x08,}},  //3.750000,    //11.441344  //0x0b70fbe4
		{0x0b959cd0, {0x4d, 0x08,}},  //3.812500,    //11.584424  //0x0b959cd0
		{0x0bb9a541, {0x4e, 0x08,}},  //3.875000,    //11.725178  //0x0bb9a541
		{0x0bdd1a1a, {0x4f, 0x08,}},  //3.937500,    //11.863680  //0x0bdd1a1a
		{0x0c000000, {0x50, 0x08,}},  //4.000000,    //12.000000  //0x0c000000
		{0x0c225b61, {0x51, 0x08,}},  //4.062500,    //12.134207  //0x0c225b61
		{0x0c44307a, {0x52, 0x08,}},  //4.125000,    //12.266365  //0x0c44307a
		{0x0c658353, {0x53, 0x08,}},  //4.187500,    //12.396535  //0x0c658353
		{0x0c8657c9, {0x54, 0x08,}},  //4.250000,    //12.524777  //0x0c8657c9
		{0x0ca6b18d, {0x55, 0x08,}},  //4.312500,    //12.651147  //0x0ca6b18d
		{0x0cc69426, {0x56, 0x08,}},  //4.375000,    //12.775698  //0x0cc69426
		{0x0ce602f6, {0x57, 0x08,}},  //4.437500,    //12.898483  //0x0ce602f6
		{0x0d05013a, {0x58, 0x08,}},  //4.500000,    //13.019550  //0x0d05013a
		{0x0d23920d, {0x59, 0x08,}},  //4.562500,    //13.138947  //0x0d23920d
		{0x0d41b86a, {0x5a, 0x08,}},  //4.625000,    //13.256720  //0x0d41b86a
		{0x0d5f772b, {0x5b, 0x08,}},  //4.687500,    //13.372912  //0x0d5f772b
		{0x0d7cd110, {0x5c, 0x08,}},  //4.750000,    //13.487565  //0x0d7cd110
		{0x0d99c8bc, {0x5d, 0x08,}},  //4.812500,    //13.600719  //0x0d99c8bc
		{0x0db660b8, {0x5e, 0x08,}},  //4.875000,    //13.712413  //0x0db660b8
		{0x0dd29b73, {0x5f, 0x08,}},  //4.937500,    //13.822684  //0x0dd29b73
		{0x0dee7b47, {0x60, 0x08,}},  //5.000000,    //13.931569  //0x0dee7b47
		{0x0e0a0275, {0x61, 0x08,}},  //5.062500,    //14.039100  //0x0e0a0275
		{0x0e25332b, {0x62, 0x08,}},  //5.125000,    //14.145312  //0x0e25332b
		{0x0e400f81, {0x63, 0x08,}},  //5.187500,    //14.250237  //0x0e400f81
		{0x0e5a997c, {0x64, 0x08,}},  //5.250000,    //14.353905  //0x0e5a997c
		{0x0e74d310, {0x65, 0x08,}},  //5.312500,    //14.456346  //0x0e74d310
		{0x0e8ebe1f, {0x66, 0x08,}},  //5.375000,    //14.557589  //0x0e8ebe1f
		{0x0ea85c78, {0x67, 0x08,}},  //5.437500,    //14.657661  //0x0ea85c78
		{0x0ec1afdd, {0x68, 0x08,}},  //5.500000,    //14.756590  //0x0ec1afdd
		{0x0edab9ff, {0x69, 0x08,}},  //5.562500,    //14.854401  //0x0edab9ff
		{0x0ef37c81, {0x6a, 0x08,}},  //5.625000,    //14.951119  //0x0ef37c81
		{0x0f0bf8fa, {0x6b, 0x08,}},  //5.687500,    //15.046768  //0x0f0bf8fa
		{0x0f2430f0, {0x6c, 0x08,}},  //5.750000,    //15.141372  //0x0f2430f0
		{0x0f3c25de, {0x6d, 0x08,}},  //5.812500,    //15.234953  //0x0f3c25de
		{0x0f53d935, {0x6e, 0x08,}},  //5.875000,    //15.327533  //0x0f53d935
		{0x0f6b4c57, {0x6f, 0x08,}},  //5.937500,    //15.419134  //0x0f6b4c57
		{0x0f82809d, {0x70, 0x08,}},  //6.000000,    //15.509775  //0x0f82809d
		{0x0f997754, {0x71, 0x08,}},  //6.062500,    //15.599477  //0x0f997754
		{0x0fb031be, {0x72, 0x08,}},  //6.125000,    //15.688259  //0x0fb031be
		{0x0fc6b117, {0x73, 0x08,}},  //6.187500,    //15.776140  //0x0fc6b117
		{0x0fdcf68e, {0x74, 0x08,}},  //6.250000,    //15.863137  //0x0fdcf68e
		{0x0ff30349, {0x75, 0x08,}},  //6.312500,    //15.949269  //0x0ff30349
		{0x1008d867, {0x76, 0x08,}},  //6.375000,    //16.034552  //0x1008d867
		{0x101e76fd, {0x77, 0x08,}},  //6.437500,    //16.119003  //0x101e76fd
		{0x1033e01a, {0x78, 0x08,}},  //6.500000,    //16.202638  //0x1033e01a
		{0x104914c3, {0x79, 0x08,}},  //6.562500,    //16.285473  //0x104914c3
		{0x105e15f8, {0x7a, 0x08,}},  //6.625000,    //16.367523  //0x105e15f8
		{0x1072e4ae, {0x7b, 0x08,}},  //6.687500,    //16.448802  //0x1072e4ae
		{0x108781d8, {0x7c, 0x08,}},  //6.750000,    //16.529325  //0x108781d8
		{0x109bee5e, {0x7d, 0x08,}},  //6.812500,    //16.609106  //0x109bee5e
		{0x10b02b24, {0x7e, 0x08,}},  //6.875000,    //16.688158  //0x10b02b24
		{0x10c43907, {0x7f, 0x08,}},  //6.937500,    //16.766495  //0x10c43907
		{0x10d818df, {0x80, 0x08,}},  //7.000000,    //16.844130  //0x10d818df
		{0x10ebcb7d, {0x81, 0x08,}},  //7.062500,    //16.921074  //0x10ebcb7d
		{0x10ff51ae, {0x82, 0x08,}},  //7.125000,    //16.997340  //0x10ff51ae
		{0x1112ac37, {0x83, 0x08,}},  //7.187500,    //17.072940  //0x1112ac37
		{0x1125dbda, {0x84, 0x08,}},  //7.250000,    //17.147886  //0x1125dbda
		{0x1138e155, {0x85, 0x08,}},  //7.312500,    //17.222188  //0x1138e155
		{0x114bbd5e, {0x86, 0x08,}},  //7.375000,    //17.295858  //0x114bbd5e
		{0x115e70a9, {0x87, 0x08,}},  //7.437500,    //17.368907  //0x115e70a9
		{0x1170fbe4, {0x88, 0x08,}},  //7.500000,    //17.441344  //0x1170fbe4
		{0x11835fba, {0x89, 0x08,}},  //7.562500,    //17.513179  //0x11835fba
		{0x11959cd0, {0x8a, 0x08,}},  //7.625000,    //17.584424  //0x11959cd0
		{0x11a7b3c8, {0x8b, 0x08,}},  //7.687500,    //17.655087  //0x11a7b3c8
		{0x11b9a541, {0x8c, 0x08,}},  //7.750000,    //17.725178  //0x11b9a541
		{0x11cb71d5, {0x8d, 0x08,}},  //7.812500,    //17.794706  //0x11cb71d5
		{0x11dd1a1a, {0x8e, 0x08,}},  //7.875000,    //17.863680  //0x11dd1a1a
		{0x11ee9ea3, {0x8f, 0x08,}},  //7.937500,    //17.932108  //0x11ee9ea3
		{0x12000000, {0x90, 0x08,}},  //8.000000,    //18.000000  //0x12000000
		{0x12113ebc, {0x91, 0x08,}},  //8.062500,    //18.067364  //0x12113ebc
		{0x12225b61, {0x92, 0x08,}},  //8.125000,    //18.134207  //0x12225b61
		{0x12335675, {0x93, 0x08,}},  //8.187500,    //18.200538  //0x12335675
		{0x1244307a, {0x94, 0x08,}},  //8.250000,    //18.266365  //0x1244307a
		{0x1254e9f0, {0x95, 0x08,}},  //8.312500,    //18.331695  //0x1254e9f0
		{0x12658353, {0x96, 0x08,}},  //8.375000,    //18.396535  //0x12658353
		{0x1275fd1f, {0x97, 0x08,}},  //8.437500,    //18.460894  //0x1275fd1f
		{0x128657c9, {0x98, 0x08,}},  //8.500000,    //18.524777  //0x128657c9
		{0x129693c8, {0x99, 0x08,}},  //8.562500,    //18.588192  //0x129693c8
		{0x12a6b18d, {0x9a, 0x08,}},  //8.625000,    //18.651147  //0x12a6b18d
		{0x12b6b188, {0x9b, 0x08,}},  //8.687500,    //18.713646  //0x12b6b188
		{0x12c69426, {0x9c, 0x08,}},  //8.750000,    //18.775698  //0x12c69426
		{0x12d659d3, {0x9d, 0x08,}},  //8.812500,    //18.837308  //0x12d659d3
		{0x12e602f6, {0x9e, 0x08,}},  //8.875000,    //18.898483  //0x12e602f6
		{0x12f58ff7, {0x9f, 0x08,}},  //8.937500,    //18.959228  //0x12f58ff7
		{0x1305013a, {0xa0, 0x08,}},  //9.000000,    //19.019550  //0x1305013a
		{0x13145721, {0xa1, 0x08,}},  //9.062500,    //19.079455  //0x13145721
		{0x1323920d, {0xa2, 0x08,}},  //9.125000,    //19.138947  //0x1323920d
		{0x1332b25c, {0xa3, 0x08,}},  //9.187500,    //19.198034  //0x1332b25c
		{0x1341b86a, {0xa4, 0x08,}},  //9.250000,    //19.256720  //0x1341b86a
		{0x1350a491, {0xa5, 0x08,}},  //9.312500,    //19.315011  //0x1350a491
		{0x135f772b, {0xa6, 0x08,}},  //9.375000,    //19.372912  //0x135f772b
		{0x136e308e, {0xa7, 0x08,}},  //9.437500,    //19.430428  //0x136e308e
		{0x137cd110, {0xa8, 0x08,}},  //9.500000,    //19.487565  //0x137cd110
		{0x138b5904, {0xa9, 0x08,}},  //9.562500,    //19.544327  //0x138b5904
		{0x1399c8bc, {0xaa, 0x08,}},  //9.625000,    //19.600719  //0x1399c8bc
		{0x13a82088, {0xab, 0x08,}},  //9.687500,    //19.656746  //0x13a82088
		{0x13b660b8, {0xac, 0x08,}},  //9.750000,    //19.712413  //0x13b660b8
		{0x13c48997, {0xad, 0x08,}},  //9.812500,    //19.767724  //0x13c48997
		{0x13d29b73, {0xae, 0x08,}},  //9.875000,    //19.822684  //0x13d29b73
		{0x13e09695, {0xaf, 0x08,}},  //9.937500,    //19.877298  //0x13e09695
		{0x13ee7b47, {0xb0, 0x08,}},  //10.000000,   //19.931569  //0x13ee7b47
		{0x13fc49cf, {0xb1, 0x08,}},  //10.062500,   //19.985501  //0x13fc49cf
		{0x140a0275, {0xb2, 0x08,}},  //10.125000,   //20.039100  //0x140a0275
		{0x1417a57d, {0xb3, 0x08,}},  //10.187500,   //20.092369  //0x1417a57d
		{0x1425332b, {0xb4, 0x08,}},  //10.250000,   //20.145312  //0x1425332b
		{0x1432abc1, {0xb5, 0x08,}},  //10.312500,   //20.197933  //0x1432abc1
		{0x14400f81, {0xb6, 0x08,}},  //10.375000,   //20.250237  //0x14400f81
		{0x144d5eaa, {0xb7, 0x08,}},  //10.437500,   //20.302226  //0x144d5eaa
		{0x145a997c, {0xb8, 0x08,}},  //10.500000,   //20.353905  //0x145a997c
		{0x1467c035, {0xb9, 0x08,}},  //10.562500,   //20.405277  //0x1467c035
		{0x1474d310, {0xba, 0x08,}},  //10.625000,   //20.456346  //0x1474d310
		{0x1481d24b, {0xbb, 0x08,}},  //10.687500,   //20.507115  //0x1481d24b
		{0x148ebe1f, {0xbc, 0x08,}},  //10.750000,   //20.557589  //0x148ebe1f
		{0x149b96c5, {0xbd, 0x08,}},  //10.812500,   //20.607769  //0x149b96c5
		{0x14a85c78, {0xbe, 0x08,}},  //10.875000,   //20.657661  //0x14a85c78
		{0x14b50f6d, {0xbf, 0x08,}},  //10.937500,   //20.707267  //0x14b50f6d
		{0x14c1afdd, {0xc0, 0x08,}},  //11.000000,   //20.756590  //0x14c1afdd
		{0x14ce3dfb, {0xc1, 0x08,}},  //11.062500,   //20.805633  //0x14ce3dfb
		{0x14dab9ff, {0xc2, 0x08,}},  //11.125000,   //20.854401  //0x14dab9ff
		{0x14e7241a, {0xc3, 0x08,}},  //11.187500,   //20.902895  //0x14e7241a
		{0x14f37c81, {0xc4, 0x08,}},  //11.250000,   //20.951119  //0x14f37c81
		{0x14ffc366, {0xc5, 0x08,}},  //11.312500,   //20.999075  //0x14ffc366
		{0x150bf8fa, {0xc6, 0x08,}},  //11.375000,   //21.046768  //0x150bf8fa
		{0x15181d6d, {0xc7, 0x08,}},  //11.437500,   //21.094199  //0x15181d6d
		{0x152430f0, {0xc8, 0x08,}},  //11.500000,   //21.141372  //0x152430f0
		{0x153033b1, {0xc9, 0x08,}},  //11.562500,   //21.188289  //0x153033b1
		{0x153c25de, {0xca, 0x08,}},  //11.625000,   //21.234953  //0x153c25de
		{0x154807a6, {0xcb, 0x08,}},  //11.687500,   //21.281367  //0x154807a6
		{0x1553d935, {0xcc, 0x08,}},  //11.750000,   //21.327533  //0x1553d935
		{0x155f9ab7, {0xcd, 0x08,}},  //11.812500,   //21.373455  //0x155f9ab7
		{0x156b4c57, {0xce, 0x08,}},  //11.875000,   //21.419134  //0x156b4c57
		{0x1576ee41, {0xcf, 0x08,}},  //11.937500,   //21.464573  //0x1576ee41
		{0x1582809d, {0xd0, 0x08,}},  //12.000000,   //21.509775  //0x1582809d
		{0x158e0396, {0xd1, 0x08,}},  //12.062500,   //21.554742  //0x158e0396
		{0x15997754, {0xd2, 0x08,}},  //12.125000,   //21.599477  //0x15997754
		{0x15a4dbff, {0xd3, 0x08,}},  //12.187500,   //21.643982  //0x15a4dbff
		{0x15b031be, {0xd4, 0x08,}},  //12.250000,   //21.688259  //0x15b031be
		{0x15bb78ba, {0xd5, 0x08,}},  //12.312500,   //21.732311  //0x15bb78ba
		{0x15c6b117, {0xd6, 0x08,}},  //12.375000,   //21.776140  //0x15c6b117
		{0x15d1dafc, {0xd7, 0x08,}},  //12.437500,   //21.819748  //0x15d1dafc
		{0x15dcf68e, {0xd8, 0x08,}},  //12.500000,   //21.863137  //0x15dcf68e
		{0x15e803f1, {0xd9, 0x08,}},  //12.562500,   //21.906310  //0x15e803f1
		{0x15f30349, {0xda, 0x08,}},  //12.625000,   //21.949269  //0x15f30349
		{0x15fdf4ba, {0xdb, 0x08,}},  //12.687500,   //21.992016  //0x15fdf4ba
		{0x1608d867, {0xdc, 0x08,}},  //12.750000,   //22.034552  //0x1608d867
		{0x1613ae72, {0xdd, 0x08,}},  //12.812500,   //22.076881  //0x1613ae72
		{0x161e76fd, {0xde, 0x08,}},  //12.875000,   //22.119003  //0x161e76fd
		{0x1629322a, {0xdf, 0x08,}},  //12.937500,   //22.160922  //0x1629322a
		{0x1633e01a, {0xe0, 0x08,}},  //13.000000,   //22.202638  //0x1633e01a
		{0x163e80ed, {0xe1, 0x08,}},  //13.062500,   //22.244155  //0x163e80ed
		{0x164914c3, {0xe2, 0x08,}},  //13.125000,   //22.285473  //0x164914c3
		{0x16539bbd, {0xe3, 0x08,}},  //13.187500,   //22.326595  //0x16539bbd
		{0x165e15f8, {0xe4, 0x08,}},  //13.250000,   //22.367523  //0x165e15f8
		{0x16688393, {0xe5, 0x08,}},  //13.312500,   //22.408258  //0x16688393
		{0x1672e4ae, {0xe6, 0x08,}},  //13.375000,   //22.448802  //0x1672e4ae
		{0x167d3966, {0xe7, 0x08,}},  //13.437500,   //22.489157  //0x167d3966
		{0x168781d8, {0xe8, 0x08,}},  //13.500000,   //22.529325  //0x168781d8
		{0x1691be21, {0xe9, 0x08,}},  //13.562500,   //22.569307  //0x1691be21
		{0x169bee5e, {0xea, 0x08,}},  //13.625000,   //22.609106  //0x169bee5e
		{0x16a612ab, {0xeb, 0x08,}},  //13.687500,   //22.648722  //0x16a612ab
		{0x16b02b24, {0xec, 0x08,}},  //13.750000,   //22.688158  //0x16b02b24
		{0x16ba37e4, {0xed, 0x08,}},  //13.812500,   //22.727415  //0x16ba37e4
		{0x16c43907, {0xee, 0x08,}},  //13.875000,   //22.766495  //0x16c43907
		{0x16ce2ea7, {0xef, 0x08,}},  //13.937500,   //22.805399  //0x16ce2ea7
		{0x16d818df, {0xf0, 0x08,}},  //14.000000,   //22.844130  //0x16d818df
		{0x16e1f7c8, {0xf1, 0x08,}},  //14.062500,   //22.882687  //0x16e1f7c8
		{0x16ebcb7d, {0xf2, 0x08,}},  //14.125000,   //22.921074  //0x16ebcb7d
		{0x16f59417, {0xf3, 0x08,}},  //14.187500,   //22.959291  //0x16f59417
		{0x16ff51ae, {0xf4, 0x08,}},  //14.250000,   //22.997340  //0x16ff51ae
		{0x1709045b, {0xf5, 0x08,}},  //14.312500,   //23.035223  //0x1709045b
		{0x1712ac37, {0xf6, 0x08,}},  //14.375000,   //23.072940  //0x1712ac37
		{0x171c4959, {0xf7, 0x08,}},  //14.437500,   //23.110494  //0x171c4959
		{0x1725dbda, {0xf8, 0x08,}},  //14.500000,   //23.147886  //0x1725dbda
		{0x1738e155, {0x85, 0x10,}},  //14.625000,   //23.222188  //0x1738e155
		{0x174bbd5e, {0x86, 0x10,}},  //14.750000,   //23.295858  //0x174bbd5e
		{0x175e70a9, {0x87, 0x10,}},  //14.875000,   //23.368907  //0x175e70a9
		{0x1770fbe4, {0x88, 0x10,}},  //15.000000,   //23.441344  //0x1770fbe4
		{0x17835fba, {0x89, 0x10,}},  //15.125000,   //23.513179  //0x17835fba
		{0x17959cd0, {0x8a, 0x10,}},  //15.250000,   //23.584424  //0x17959cd0
		{0x17a7b3c8, {0x8b, 0x10,}},  //15.375000,   //23.655087  //0x17a7b3c8
		{0x17b9a541, {0x8c, 0x10,}},  //15.500000,   //23.725178  //0x17b9a541
		{0x17cb71d5, {0x8d, 0x10,}},  //15.625000,   //23.794706  //0x17cb71d5
		{0x17dd1a1a, {0x8e, 0x10,}},  //15.750000,   //23.863680  //0x17dd1a1a
		{0x17ee9ea3, {0x8f, 0x10,}},  //15.875000,   //23.932108  //0x17ee9ea3
		{0x18000000, {0x90, 0x10,}},  //16.000000,   //24.000000  //0x18000000
		{0x18113ebc, {0x91, 0x10,}},  //16.125000,   //24.067364  //0x18113ebc
		{0x18225b61, {0x92, 0x10,}},  //16.250000,   //24.134207  //0x18225b61
		{0x18335675, {0x93, 0x10,}},  //16.375000,   //24.200538  //0x18335675
		{0x1844307a, {0x94, 0x10,}},  //16.500000,   //24.266365  //0x1844307a
		{0x1854e9f0, {0x95, 0x10,}},  //16.625000,   //24.331695  //0x1854e9f0
		{0x18658353, {0x96, 0x10,}},  //16.750000,   //24.396535  //0x18658353
		{0x1875fd1f, {0x97, 0x10,}},  //16.875000,   //24.460894  //0x1875fd1f
		{0x188657c9, {0x98, 0x10,}},  //17.000000,   //24.524777  //0x188657c9
		{0x189693c8, {0x99, 0x10,}},  //17.125000,   //24.588192  //0x189693c8
		{0x18a6b18d, {0x9a, 0x10,}},  //17.250000,   //24.651147  //0x18a6b18d
		{0x18b6b188, {0x9b, 0x10,}},  //17.375000,   //24.713646  //0x18b6b188
		{0x18c69426, {0x9c, 0x10,}},  //17.500000,   //24.775698  //0x18c69426
		{0x18d659d3, {0x9d, 0x10,}},  //17.625000,   //24.837308  //0x18d659d3
		{0x18e602f6, {0x9e, 0x10,}},  //17.750000,   //24.898483  //0x18e602f6
		{0x18f58ff7, {0x9f, 0x10,}},  //17.875000,   //24.959228  //0x18f58ff7
		{0x1905013a, {0xa0, 0x10,}},  //18.000000,   //25.019550  //0x1905013a
		{0x19145721, {0xa1, 0x10,}},  //18.125000,   //25.079455  //0x19145721
		{0x1923920d, {0xa2, 0x10,}},  //18.250000,   //25.138947  //0x1923920d
		{0x1932b25c, {0xa3, 0x10,}},  //18.375000,   //25.198034  //0x1932b25c
		{0x1941b86a, {0xa4, 0x10,}},  //18.500000,   //25.256720  //0x1941b86a
		{0x1950a491, {0xa5, 0x10,}},  //18.625000,   //25.315011  //0x1950a491
		{0x195f772b, {0xa6, 0x10,}},  //18.750000,   //25.372912  //0x195f772b
		{0x196e308e, {0xa7, 0x10,}},  //18.875000,   //25.430428  //0x196e308e
		{0x197cd110, {0xa8, 0x10,}},  //19.000000,   //25.487565  //0x197cd110
		{0x198b5904, {0xa9, 0x10,}},  //19.125000,   //25.544327  //0x198b5904
		{0x1999c8bc, {0xaa, 0x10,}},  //19.250000,   //25.600719  //0x1999c8bc
		{0x19a82088, {0xab, 0x10,}},  //19.375000,   //25.656746  //0x19a82088
		{0x19b660b8, {0xac, 0x10,}},  //19.500000,   //25.712413  //0x19b660b8
		{0x19c48997, {0xad, 0x10,}},  //19.625000,   //25.767724  //0x19c48997
		{0x19d29b73, {0xae, 0x10,}},  //19.750000,   //25.822684  //0x19d29b73
		{0x19e09695, {0xaf, 0x10,}},  //19.875000,   //25.877298  //0x19e09695
		{0x19ee7b47, {0xb0, 0x10,}},  //20.000000,   //25.931569  //0x19ee7b47
		{0x19fc49cf, {0xb1, 0x10,}},  //20.125000,   //25.985501  //0x19fc49cf
		{0x1a0a0275, {0xb2, 0x10,}},  //20.250000,   //26.039100  //0x1a0a0275
		{0x1a17a57d, {0xb3, 0x10,}},  //20.375000,   //26.092369  //0x1a17a57d
		{0x1a25332b, {0xb4, 0x10,}},  //20.500000,   //26.145312  //0x1a25332b
		{0x1a32abc1, {0xb5, 0x10,}},  //20.625000,   //26.197933  //0x1a32abc1
		{0x1a400f81, {0xb6, 0x10,}},  //20.750000,   //26.250237  //0x1a400f81
		{0x1a4d5eaa, {0xb7, 0x10,}},  //20.875000,   //26.302226  //0x1a4d5eaa
		{0x1a5a997c, {0xb8, 0x10,}},  //21.000000,   //26.353905  //0x1a5a997c
		{0x1a67c035, {0xb9, 0x10,}},  //21.125000,   //26.405277  //0x1a67c035
		{0x1a74d310, {0xba, 0x10,}},  //21.250000,   //26.456346  //0x1a74d310
		{0x1a81d24b, {0xbb, 0x10,}},  //21.375000,   //26.507115  //0x1a81d24b
		{0x1a8ebe1f, {0xbc, 0x10,}},  //21.500000,   //26.557589  //0x1a8ebe1f
		{0x1a9b96c5, {0xbd, 0x10,}},  //21.625000,   //26.607769  //0x1a9b96c5
		{0x1aa85c78, {0xbe, 0x10,}},  //21.750000,   //26.657661  //0x1aa85c78
		{0x1ab50f6d, {0xbf, 0x10,}},  //21.875000,   //26.707267  //0x1ab50f6d
		{0x1ac1afdd, {0xc0, 0x10,}},  //22.000000,   //26.756590  //0x1ac1afdd
		{0x1ace3dfb, {0xc1, 0x10,}},  //22.125000,   //26.805633  //0x1ace3dfb
		{0x1adab9ff, {0xc2, 0x10,}},  //22.250000,   //26.854401  //0x1adab9ff
		{0x1ae7241a, {0xc3, 0x10,}},  //22.375000,   //26.902895  //0x1ae7241a
		{0x1af37c81, {0xc4, 0x10,}},  //22.500000,   //26.951119  //0x1af37c81
		{0x1affc366, {0xc5, 0x10,}},  //22.625000,   //26.999075  //0x1affc366
		{0x1b0bf8fa, {0xc6, 0x10,}},  //22.750000,   //27.046768  //0x1b0bf8fa
		{0x1b181d6d, {0xc7, 0x10,}},  //22.875000,   //27.094199  //0x1b181d6d
		{0x1b2430f0, {0xc8, 0x10,}},  //23.000000,   //27.141372  //0x1b2430f0
		{0x1b3033b1, {0xc9, 0x10,}},  //23.125000,   //27.188289  //0x1b3033b1
		{0x1b3c25de, {0xca, 0x10,}},  //23.250000,   //27.234953  //0x1b3c25de
		{0x1b4807a6, {0xcb, 0x10,}},  //23.375000,   //27.281367  //0x1b4807a6
		{0x1b53d935, {0xcc, 0x10,}},  //23.500000,   //27.327533  //0x1b53d935
		{0x1b5f9ab7, {0xcd, 0x10,}},  //23.625000,   //27.373455  //0x1b5f9ab7
		{0x1b6b4c57, {0xce, 0x10,}},  //23.750000,   //27.419134  //0x1b6b4c57
		{0x1b76ee41, {0xcf, 0x10,}},  //23.875000,   //27.464573  //0x1b76ee41
		{0x1b82809d, {0xd0, 0x10,}},  //24.000000,   //27.509775  //0x1b82809d
		{0x1b8e0396, {0xd1, 0x10,}},  //24.125000,   //27.554742  //0x1b8e0396
		{0x1b997754, {0xd2, 0x10,}},  //24.250000,   //27.599477  //0x1b997754
		{0x1ba4dbff, {0xd3, 0x10,}},  //24.375000,   //27.643982  //0x1ba4dbff
		{0x1bb031be, {0xd4, 0x10,}},  //24.500000,   //27.688259  //0x1bb031be
		{0x1bbb78ba, {0xd5, 0x10,}},  //24.625000,   //27.732311  //0x1bbb78ba
		{0x1bc6b117, {0xd6, 0x10,}},  //24.750000,   //27.776140  //0x1bc6b117
		{0x1bd1dafc, {0xd7, 0x10,}},  //24.875000,   //27.819748  //0x1bd1dafc
		{0x1bdcf68e, {0xd8, 0x10,}},  //25.000000,   //27.863137  //0x1bdcf68e
		{0x1be803f1, {0xd9, 0x10,}},  //25.125000,   //27.906310  //0x1be803f1
		{0x1bf30349, {0xda, 0x10,}},  //25.250000,   //27.949269  //0x1bf30349
		{0x1bfdf4ba, {0xdb, 0x10,}},  //25.375000,   //27.992016  //0x1bfdf4ba
		{0x1c08d867, {0xdc, 0x10,}},  //25.500000,   //28.034552  //0x1c08d867
		{0x1c13ae72, {0xdd, 0x10,}},  //25.625000,   //28.076881  //0x1c13ae72
		{0x1c1e76fd, {0xde, 0x10,}},  //25.750000,   //28.119003  //0x1c1e76fd
		{0x1c29322a, {0xdf, 0x10,}},  //25.875000,   //28.160922  //0x1c29322a
		{0x1c33e01a, {0xe0, 0x10,}},  //26.000000,   //28.202638  //0x1c33e01a
		{0x1c3e80ed, {0xe1, 0x10,}},  //26.125000,   //28.244155  //0x1c3e80ed
		{0x1c4914c3, {0xe2, 0x10,}},  //26.250000,   //28.285473  //0x1c4914c3
		{0x1c539bbd, {0xe3, 0x10,}},  //26.375000,   //28.326595  //0x1c539bbd
		{0x1c5e15f8, {0xe4, 0x10,}},  //26.500000,   //28.367523  //0x1c5e15f8
		{0x1c688393, {0xe5, 0x10,}},  //26.625000,   //28.408258  //0x1c688393
		{0x1c72e4ae, {0xe6, 0x10,}},  //26.750000,   //28.448802  //0x1c72e4ae
		{0x1c7d3966, {0xe7, 0x10,}},  //26.875000,   //28.489157  //0x1c7d3966
		{0x1c8781d8, {0xe8, 0x10,}},  //27.000000,   //28.529325  //0x1c8781d8
		{0x1c91be21, {0xe9, 0x10,}},  //27.125000,   //28.569307  //0x1c91be21
		{0x1c9bee5e, {0xea, 0x10,}},  //27.250000,   //28.609106  //0x1c9bee5e
		{0x1ca612ab, {0xeb, 0x10,}},  //27.375000,   //28.648722  //0x1ca612ab
		{0x1cb02b24, {0xec, 0x10,}},  //27.500000,   //28.688158  //0x1cb02b24
		{0x1cba37e4, {0xed, 0x10,}},  //27.625000,   //28.727415  //0x1cba37e4
		{0x1cc43907, {0xee, 0x10,}},  //27.750000,   //28.766495  //0x1cc43907
		{0x1cce2ea7, {0xef, 0x10,}},  //27.875000,   //28.805399  //0x1cce2ea7
		{0x1cd818df, {0xf0, 0x10,}},  //28.000000,   //28.844130  //0x1cd818df
		{0x1ce1f7c8, {0xf1, 0x10,}},  //28.125000,   //28.882687  //0x1ce1f7c8
		{0x1cebcb7d, {0xf2, 0x10,}},  //28.250000,   //28.921074  //0x1cebcb7d
		{0x1cf59417, {0xf3, 0x10,}},  //28.375000,   //28.959291  //0x1cf59417
		{0x1cff51ae, {0xf4, 0x10,}},  //28.500000,   //28.997340  //0x1cff51ae
		{0x1d09045b, {0xf5, 0x10,}},  //28.625000,   //29.035223  //0x1d09045b
		{0x1d12ac37, {0xf6, 0x10,}},  //28.750000,   //29.072940  //0x1d12ac37
		{0x1d1c4959, {0xf7, 0x10,}},  //28.875000,   //29.110494  //0x1d1c4959
		{0x1d25dbda, {0xf8, 0x10,}},  //29.000000,   //29.147886  //0x1d25dbda
		{0x1d38e155, {0x85, 0x20,}},  //29.250000,   //29.222188  //0x1d38e155
		{0x1d4bbd5e, {0x86, 0x20,}},  //29.500000,   //29.295858  //0x1d4bbd5e
		{0x1d5e70a9, {0x87, 0x20,}},  //29.750000,   //29.368907  //0x1d5e70a9
		{0x1d70fbe4, {0x88, 0x20,}},  //30.000000,   //29.441344  //0x1d70fbe4
		{0x1d835fba, {0x89, 0x20,}},  //30.250000,   //29.513179  //0x1d835fba
		{0x1d959cd0, {0x8a, 0x20,}},  //30.500000,   //29.584424  //0x1d959cd0
		{0x1da7b3c8, {0x8b, 0x20,}},  //30.750000,   //29.655087  //0x1da7b3c8
		{0x1db9a541, {0x8c, 0x20,}},  //31.000000,   //29.725178  //0x1db9a541
		{0x1dcb71d5, {0x8d, 0x20,}},  //31.250000,   //29.794706  //0x1dcb71d5
		{0x1ddd1a1a, {0x8e, 0x20,}},  //31.500000,   //29.863680  //0x1ddd1a1a
		{0x1dee9ea3, {0x8f, 0x20,}},  //31.750000,   //29.932108  //0x1dee9ea3
		{0x1e000000, {0x90, 0x20,}},  //32.000000,   //30.000000  //0x1e000000
		{0x1e113ebc, {0x91, 0x20,}},  //32.250000,   //30.067364  //0x1e113ebc
		{0x1e225b61, {0x92, 0x20,}},  //32.500000,   //30.134207  //0x1e225b61
		{0x1e335675, {0x93, 0x20,}},  //32.750000,   //30.200538  //0x1e335675
		{0x1e44307a, {0x94, 0x20,}},  //33.000000,   //30.266365  //0x1e44307a
		{0x1e54e9f0, {0x95, 0x20,}},  //33.250000,   //30.331695  //0x1e54e9f0
		{0x1e658353, {0x96, 0x20,}},  //33.500000,   //30.396535  //0x1e658353
		{0x1e75fd1f, {0x97, 0x20,}},  //33.750000,   //30.460894  //0x1e75fd1f
		{0x1e8657c9, {0x98, 0x20,}},  //34.000000,   //30.524777  //0x1e8657c9
		{0x1e9693c8, {0x99, 0x20,}},  //34.250000,   //30.588192  //0x1e9693c8
		{0x1ea6b18d, {0x9a, 0x20,}},  //34.500000,   //30.651147  //0x1ea6b18d
		{0x1eb6b188, {0x9b, 0x20,}},  //34.750000,   //30.713646  //0x1eb6b188
		{0x1ec69426, {0x9c, 0x20,}},  //35.000000,   //30.775698  //0x1ec69426
		{0x1ed659d3, {0x9d, 0x20,}},  //35.250000,   //30.837308  //0x1ed659d3
		{0x1ee602f6, {0x9e, 0x20,}},  //35.500000,   //30.898483  //0x1ee602f6
		{0x1ef58ff7, {0x9f, 0x20,}},  //35.750000,   //30.959228  //0x1ef58ff7
		{0x1f05013a, {0xa0, 0x20,}},  //36.000000,   //31.019550  //0x1f05013a
		{0x1f145721, {0xa1, 0x20,}},  //36.250000,   //31.079455  //0x1f145721
		{0x1f23920d, {0xa2, 0x20,}},  //36.500000,   //31.138947  //0x1f23920d
		{0x1f32b25c, {0xa3, 0x20,}},  //36.750000,   //31.198034  //0x1f32b25c
		{0x1f41b86a, {0xa4, 0x20,}},  //37.000000,   //31.256720  //0x1f41b86a
		{0x1f50a491, {0xa5, 0x20,}},  //37.250000,   //31.315011  //0x1f50a491
		{0x1f5f772b, {0xa6, 0x20,}},  //37.500000,   //31.372912  //0x1f5f772b
		{0x1f6e308e, {0xa7, 0x20,}},  //37.750000,   //31.430428  //0x1f6e308e
		{0x1f7cd110, {0xa8, 0x20,}},  //38.000000,   //31.487565  //0x1f7cd110
		{0x1f8b5904, {0xa9, 0x20,}},  //38.250000,   //31.544327  //0x1f8b5904
		{0x1f99c8bc, {0xaa, 0x20,}},  //38.500000,   //31.600719  //0x1f99c8bc
		{0x1fa82088, {0xab, 0x20,}},  //38.750000,   //31.656746  //0x1fa82088
		{0x1fb660b8, {0xac, 0x20,}},  //39.000000,   //31.712413  //0x1fb660b8
		{0x1fc48997, {0xad, 0x20,}},  //39.250000,   //31.767724  //0x1fc48997
		{0x1fd29b73, {0xae, 0x20,}},  //39.500000,   //31.822684  //0x1fd29b73
		{0x1fe09695, {0xaf, 0x20,}},  //39.750000,   //31.877298  //0x1fe09695
		{0x1fee7b47, {0xb0, 0x20,}},  //40.000000,   //31.931569  //0x1fee7b47
		{0x1ffc49cf, {0xb1, 0x20,}},  //40.250000,   //31.985501  //0x1ffc49cf
		{0x200a0275, {0xb2, 0x20,}},  //40.500000,   //32.039100  //0x200a0275
		{0x2017a57d, {0xb3, 0x20,}},  //40.750000,   //32.092369  //0x2017a57d
		{0x2025332b, {0xb4, 0x20,}},  //41.000000,   //32.145312  //0x2025332b
		{0x2032abc1, {0xb5, 0x20,}},  //41.250000,   //32.197933  //0x2032abc1
		{0x20400f81, {0xb6, 0x20,}},  //41.500000,   //32.250237  //0x20400f81
		{0x204d5eaa, {0xb7, 0x20,}},  //41.750000,   //32.302226  //0x204d5eaa
		{0x205a997c, {0xb8, 0x20,}},  //42.000000,   //32.353905  //0x205a997c
		{0x2067c035, {0xb9, 0x20,}},  //42.250000,   //32.405277  //0x2067c035
		{0x2074d310, {0xba, 0x20,}},  //42.500000,   //32.456346  //0x2074d310
		{0x2081d24b, {0xbb, 0x20,}},  //42.750000,   //32.507115  //0x2081d24b
		{0x208ebe1f, {0xbc, 0x20,}},  //43.000000,   //32.557589  //0x208ebe1f
		{0x209b96c5, {0xbd, 0x20,}},  //43.250000,   //32.607769  //0x209b96c5
		{0x20a85c78, {0xbe, 0x20,}},  //43.500000,   //32.657661  //0x20a85c78
		{0x20b50f6d, {0xbf, 0x20,}},  //43.750000,   //32.707267  //0x20b50f6d
		{0x20c1afdd, {0xc0, 0x20,}},  //44.000000,   //32.756590  //0x20c1afdd
		{0x20ce3dfb, {0xc1, 0x20,}},  //44.250000,   //32.805633  //0x20ce3dfb
		{0x20dab9ff, {0xc2, 0x20,}},  //44.500000,   //32.854401  //0x20dab9ff
		{0x20e7241a, {0xc3, 0x20,}},  //44.750000,   //32.902895  //0x20e7241a
		{0x20f37c81, {0xc4, 0x20,}},  //45.000000,   //32.951119  //0x20f37c81
		{0x20ffc366, {0xc5, 0x20,}},  //45.250000,   //32.999075  //0x20ffc366
		{0x210bf8fa, {0xc6, 0x20,}},  //45.500000,   //33.046768  //0x210bf8fa
		{0x21181d6d, {0xc7, 0x20,}},  //45.750000,   //33.094199  //0x21181d6d
		{0x212430f0, {0xc8, 0x20,}},  //46.000000,   //33.141372  //0x212430f0
		{0x213033b1, {0xc9, 0x20,}},  //46.250000,   //33.188289  //0x213033b1
		{0x213c25de, {0xca, 0x20,}},  //46.500000,   //33.234953  //0x213c25de
		{0x214807a6, {0xcb, 0x20,}},  //46.750000,   //33.281367  //0x214807a6
		{0x2153d935, {0xcc, 0x20,}},  //47.000000,   //33.327533  //0x2153d935
		{0x215f9ab7, {0xcd, 0x20,}},  //47.250000,   //33.373455  //0x215f9ab7
		{0x216b4c57, {0xce, 0x20,}},  //47.500000,   //33.419134  //0x216b4c57
		{0x2176ee41, {0xcf, 0x20,}},  //47.750000,   //33.464573  //0x2176ee41
		{0x2182809d, {0xd0, 0x20,}},  //48.000000,   //33.509775  //0x2182809d
		{0x218e0396, {0xd1, 0x20,}},  //48.250000,   //33.554742  //0x218e0396
		{0x21997754, {0xd2, 0x20,}},  //48.500000,   //33.599477  //0x21997754
		{0x21a4dbff, {0xd3, 0x20,}},  //48.750000,   //33.643982  //0x21a4dbff
		{0x21b031be, {0xd4, 0x20,}},  //49.000000,   //33.688259  //0x21b031be
		{0x21bb78ba, {0xd5, 0x20,}},  //49.250000,   //33.732311  //0x21bb78ba
		{0x21c6b117, {0xd6, 0x20,}},  //49.500000,   //33.776140  //0x21c6b117
		{0x21d1dafc, {0xd7, 0x20,}},  //49.750000,   //33.819748  //0x21d1dafc
		{0x21dcf68e, {0xd8, 0x20,}},  //50.000000,   //33.863137  //0x21dcf68e
		{0x21e803f1, {0xd9, 0x20,}},  //50.250000,   //33.906310  //0x21e803f1
		{0x21f30349, {0xda, 0x20,}},  //50.500000,   //33.949269  //0x21f30349
		{0x21fdf4ba, {0xdb, 0x20,}},  //50.750000,   //33.992016  //0x21fdf4ba
		{0x2208d867, {0xdc, 0x20,}},  //51.000000,   //34.034552  //0x2208d867
		{0x2213ae72, {0xdd, 0x20,}},  //51.250000,   //34.076881  //0x2213ae72
		{0x221e76fd, {0xde, 0x20,}},  //51.500000,   //34.119003  //0x221e76fd
		{0x2229322a, {0xdf, 0x20,}},  //51.750000,   //34.160922  //0x2229322a
		{0x2233e01a, {0xe0, 0x20,}},  //52.000000,   //34.202638  //0x2233e01a
		{0x223e80ed, {0xe1, 0x20,}},  //52.250000,   //34.244155  //0x223e80ed
		{0x224914c3, {0xe2, 0x20,}},  //52.500000,   //34.285473  //0x224914c3
		{0x22539bbd, {0xe3, 0x20,}},  //52.750000,   //34.326595  //0x22539bbd
		{0x225e15f8, {0xe4, 0x20,}},  //53.000000,   //34.367523  //0x225e15f8
		{0x22688393, {0xe5, 0x20,}},  //53.250000,   //34.408258  //0x22688393
		{0x2272e4ae, {0xe6, 0x20,}},  //53.500000,   //34.448802  //0x2272e4ae
		{0x227d3966, {0xe7, 0x20,}},  //53.750000,   //34.489157  //0x227d3966
		{0x228781d8, {0xe8, 0x20,}},  //54.000000,   //34.529325  //0x228781d8
		{0x2291be21, {0xe9, 0x20,}},  //54.250000,   //34.569307  //0x2291be21
		{0x229bee5e, {0xea, 0x20,}},  //54.500000,   //34.609106  //0x229bee5e
		{0x22a612ab, {0xeb, 0x20,}},  //54.750000,   //34.648722  //0x22a612ab
		{0x22b02b24, {0xec, 0x20,}},  //55.000000,   //34.688158  //0x22b02b24
		{0x22ba37e4, {0xed, 0x20,}},  //55.250000,   //34.727415  //0x22ba37e4
		{0x22c43907, {0xee, 0x20,}},  //55.500000,   //34.766495  //0x22c43907
		{0x22ce2ea7, {0xef, 0x20,}},  //55.750000,   //34.805399  //0x22ce2ea7
		{0x22d818df, {0xf0, 0x20,}},  //56.000000,   //34.844130  //0x22d818df
		{0x22e1f7c8, {0xf1, 0x20,}},  //56.250000,   //34.882687  //0x22e1f7c8
		{0x22ebcb7d, {0xf2, 0x20,}},  //56.500000,   //34.921074  //0x22ebcb7d
		{0x22f59417, {0xf3, 0x20,}},  //56.750000,   //34.959291  //0x22f59417
		{0x22ff51ae, {0xf4, 0x20,}},  //57.000000,   //34.997340  //0x22ff51ae
		{0x2309045b, {0xf5, 0x20,}},  //57.250000,   //35.035223  //0x2309045b
		{0x2312ac37, {0xf6, 0x20,}},  //57.500000,   //35.072940  //0x2312ac37
		{0x231c4959, {0xf7, 0x20,}},  //57.750000,   //35.110494  //0x231c4959
		{0x2325dbda, {0xf8, 0x20,}},  //58.000000,   //35.147886  //0x2325dbda
		{0x2338e155, {0x85, 0x40,}},  //58.500000,   //35.222188  //0x2338e155
		{0x234bbd5e, {0x86, 0x40,}},  //59.000000,   //35.295858  //0x234bbd5e
		{0x235e70a9, {0x87, 0x40,}},  //59.500000,   //35.368907  //0x235e70a9
		{0x2370fbe4, {0x88, 0x40,}},  //60.000000,   //35.441344  //0x2370fbe4
		{0x23835fba, {0x89, 0x40,}},  //60.500000,   //35.513179  //0x23835fba
		{0x23959cd0, {0x8a, 0x40,}},  //61.000000,   //35.584424  //0x23959cd0
		{0x23a7b3c8, {0x8b, 0x40,}},  //61.500000,   //35.655087  //0x23a7b3c8
		{0x23b9a541, {0x8c, 0x40,}},  //62.000000,   //35.725178  //0x23b9a541
		{0x23cb71d5, {0x8d, 0x40,}},  //62.500000,   //35.794706  //0x23cb71d5
		{0x23dd1a1a, {0x8e, 0x40,}},  //63.000000,   //35.863680  //0x23dd1a1a
		{0x23ee9ea3, {0x8f, 0x40,}},  //63.500000,   //35.932108  //0x23ee9ea3
		{0x24000000, {0x90, 0x40,}},  //64.000000,   //36.000000  //0x24000000
		{0x24113ebc, {0x91, 0x40,}},  //64.500000,   //36.067364  //0x24113ebc
		{0x24225b61, {0x92, 0x40,}},  //65.000000,   //36.134207  //0x24225b61
		{0x24335675, {0x93, 0x40,}},  //65.500000,   //36.200538  //0x24335675
		{0x2444307a, {0x94, 0x40,}},  //66.000000,   //36.266365  //0x2444307a
		{0x2454e9f0, {0x95, 0x40,}},  //66.500000,   //36.331695  //0x2454e9f0
		{0x24658353, {0x96, 0x40,}},  //67.000000,   //36.396535  //0x24658353
		{0x2475fd1f, {0x97, 0x40,}},  //67.500000,   //36.460894  //0x2475fd1f
		{0x248657c9, {0x98, 0x40,}},  //68.000000,   //36.524777  //0x248657c9
		{0x249693c8, {0x99, 0x40,}},  //68.500000,   //36.588192  //0x249693c8
		{0x24a6b18d, {0x9a, 0x40,}},  //69.000000,   //36.651147  //0x24a6b18d
		{0x24b6b188, {0x9b, 0x40,}},  //69.500000,   //36.713646  //0x24b6b188
		{0x24c69426, {0x9c, 0x40,}},  //70.000000,   //36.775698  //0x24c69426
		{0x24d659d3, {0x9d, 0x40,}},  //70.500000,   //36.837308  //0x24d659d3
		{0x24e602f6, {0x9e, 0x40,}},  //71.000000,   //36.898483  //0x24e602f6
		{0x24f58ff7, {0x9f, 0x40,}},  //71.500000,   //36.959228  //0x24f58ff7
		{0x2505013a, {0xa0, 0x40,}},  //72.000000,   //37.019550  //0x2505013a
		{0x25145721, {0xa1, 0x40,}},  //72.500000,   //37.079455  //0x25145721
		{0x2523920d, {0xa2, 0x40,}},  //73.000000,   //37.138947  //0x2523920d
		{0x2532b25c, {0xa3, 0x40,}},  //73.500000,   //37.198034  //0x2532b25c
		{0x2541b86a, {0xa4, 0x40,}},  //74.000000,   //37.256720  //0x2541b86a
		{0x2550a491, {0xa5, 0x40,}},  //74.500000,   //37.315011  //0x2550a491
		{0x255f772b, {0xa6, 0x40,}},  //75.000000,   //37.372912  //0x255f772b
		{0x256e308e, {0xa7, 0x40,}},  //75.500000,   //37.430428  //0x256e308e
		{0x257cd110, {0xa8, 0x40,}},  //76.000000,   //37.487565  //0x257cd110
		{0x258b5904, {0xa9, 0x40,}},  //76.500000,   //37.544327  //0x258b5904
		{0x2599c8bc, {0xaa, 0x40,}},  //77.000000,   //37.600719  //0x2599c8bc
		{0x25a82088, {0xab, 0x40,}},  //77.500000,   //37.656746  //0x25a82088
		{0x25b660b8, {0xac, 0x40,}},  //78.000000,   //37.712413  //0x25b660b8
		{0x25c48997, {0xad, 0x40,}},  //78.500000,   //37.767724  //0x25c48997
		{0x25d29b73, {0xae, 0x40,}},  //79.000000,   //37.822684  //0x25d29b73
		{0x25e09695, {0xaf, 0x40,}},  //79.500000,   //37.877298  //0x25e09695
		{0x25ee7b47, {0xb0, 0x40,}},  //80.000000,   //37.931569  //0x25ee7b47
		{0x25fc49cf, {0xb1, 0x40,}},  //80.500000,   //37.985501  //0x25fc49cf
		{0x260a0275, {0xb2, 0x40,}},  //81.000000,   //38.039100  //0x260a0275
		{0x2617a57d, {0xb3, 0x40,}},  //81.500000,   //38.092369  //0x2617a57d
		{0x2625332b, {0xb4, 0x40,}},  //82.000000,   //38.145312  //0x2625332b
		{0x2632abc1, {0xb5, 0x40,}},  //82.500000,   //38.197933  //0x2632abc1
		{0x26400f81, {0xb6, 0x40,}},  //83.000000,   //38.250237  //0x26400f81
		{0x264d5eaa, {0xb7, 0x40,}},  //83.500000,   //38.302226  //0x264d5eaa
		{0x265a997c, {0xb8, 0x40,}},  //84.000000,   //38.353905  //0x265a997c
		{0x2667c035, {0xb9, 0x40,}},  //84.500000,   //38.405277  //0x2667c035
		{0x2674d310, {0xba, 0x40,}},  //85.000000,   //38.456346  //0x2674d310
		{0x2681d24b, {0xbb, 0x40,}},  //85.500000,   //38.507115  //0x2681d24b
		{0x268ebe1f, {0xbc, 0x40,}},  //86.000000,   //38.557589  //0x268ebe1f
		{0x269b96c5, {0xbd, 0x40,}},  //86.500000,   //38.607769  //0x269b96c5
		{0x26a85c78, {0xbe, 0x40,}},  //87.000000,   //38.657661  //0x26a85c78
		{0x26b50f6d, {0xbf, 0x40,}},  //87.500000,   //38.707267  //0x26b50f6d
		{0x26c1afdd, {0xc0, 0x40,}},  //88.000000,   //38.756590  //0x26c1afdd
		{0x26ce3dfb, {0xc1, 0x40,}},  //88.500000,   //38.805633  //0x26ce3dfb
		{0x26dab9ff, {0xc2, 0x40,}},  //89.000000,   //38.854401  //0x26dab9ff
		{0x26e7241a, {0xc3, 0x40,}},  //89.500000,   //38.902895  //0x26e7241a
		{0x26f37c81, {0xc4, 0x40,}},  //90.000000,   //38.951119  //0x26f37c81
		{0x26ffc366, {0xc5, 0x40,}},  //90.500000,   //38.999075  //0x26ffc366
		{0x270bf8fa, {0xc6, 0x40,}},  //91.000000,   //39.046768  //0x270bf8fa
		{0x27181d6d, {0xc7, 0x40,}},  //91.500000,   //39.094199  //0x27181d6d
		{0x272430f0, {0xc8, 0x40,}},  //92.000000,   //39.141372  //0x272430f0
		{0x273033b1, {0xc9, 0x40,}},  //92.500000,   //39.188289  //0x273033b1
		{0x273c25de, {0xca, 0x40,}},  //93.000000,   //39.234953  //0x273c25de
		{0x274807a6, {0xcb, 0x40,}},  //93.500000,   //39.281367  //0x274807a6
		{0x2753d935, {0xcc, 0x40,}},  //94.000000,   //39.327533  //0x2753d935
		{0x275f9ab7, {0xcd, 0x40,}},  //94.500000,   //39.373455  //0x275f9ab7
		{0x276b4c57, {0xce, 0x40,}},  //95.000000,   //39.419134  //0x276b4c57
		{0x2776ee41, {0xcf, 0x40,}},  //95.500000,   //39.464573  //0x2776ee41
		{0x2782809d, {0xd0, 0x40,}},  //96.000000,   //39.509775  //0x2782809d
		{0x278e0396, {0xd1, 0x40,}},  //96.500000,   //39.554742  //0x278e0396
		{0x27997754, {0xd2, 0x40,}},  //97.000000,   //39.599477  //0x27997754
		{0x27a4dbff, {0xd3, 0x40,}},  //97.500000,   //39.643982  //0x27a4dbff
		{0x27b031be, {0xd4, 0x40,}},  //98.000000,   //39.688259  //0x27b031be
		{0x27bb78ba, {0xd5, 0x40,}},  //98.500000,   //39.732311  //0x27bb78ba
		{0x27c6b117, {0xd6, 0x40,}},  //99.000000,   //39.776140  //0x27c6b117
		{0x27d1dafc, {0xd7, 0x40,}},  //99.500000,   //39.819748  //0x27d1dafc
		{0x27dcf68e, {0xd8, 0x40,}},  //100.000000,  //39.863137  //0x27dcf68e
		{0x27e803f1, {0xd9, 0x40,}},  //100.500000,  //39.906310  //0x27e803f1
		{0x27f30349, {0xda, 0x40,}},  //101.000000,  //39.949269  //0x27f30349
		{0x27fdf4ba, {0xdb, 0x40,}},  //101.500000,  //39.992016  //0x27fdf4ba
		{0x2808d867, {0xdc, 0x40,}},  //102.000000,  //40.034552  //0x2808d867
		{0x2813ae72, {0xdd, 0x40,}},  //102.500000,  //40.076881  //0x2813ae72
		{0x281e76fd, {0xde, 0x40,}},  //103.000000,  //40.119003  //0x281e76fd
		{0x2829322a, {0xdf, 0x40,}},  //103.500000,  //40.160922  //0x2829322a
		{0x2833e01a, {0xe0, 0x40,}},  //104.000000,  //40.202638  //0x2833e01a
		{0x283e80ed, {0xe1, 0x40,}},  //104.500000,  //40.244155  //0x283e80ed
		{0x284914c3, {0xe2, 0x40,}},  //105.000000,  //40.285473  //0x284914c3
		{0x28539bbd, {0xe3, 0x40,}},  //105.500000,  //40.326595  //0x28539bbd
		{0x285e15f8, {0xe4, 0x40,}},  //106.000000,  //40.367523  //0x285e15f8
		{0x28688393, {0xe5, 0x40,}},  //106.500000,  //40.408258  //0x28688393
		{0x2872e4ae, {0xe6, 0x40,}},  //107.000000,  //40.448802  //0x2872e4ae
		{0x287d3966, {0xe7, 0x40,}},  //107.500000,  //40.489157  //0x287d3966
		{0x288781d8, {0xe8, 0x40,}},  //108.000000,  //40.529325  //0x288781d8
		{0x2891be21, {0xe9, 0x40,}},  //108.500000,  //40.569307  //0x2891be21
		{0x289bee5e, {0xea, 0x40,}},  //109.000000,  //40.609106  //0x289bee5e
		{0x28a612ab, {0xeb, 0x40,}},  //109.500000,  //40.648722  //0x28a612ab
		{0x28b02b24, {0xec, 0x40,}},  //110.000000,  //40.688158  //0x28b02b24
		{0x28ba37e4, {0xed, 0x40,}},  //110.500000,  //40.727415  //0x28ba37e4
		{0x28c43907, {0xee, 0x40,}},  //111.000000,  //40.766495  //0x28c43907
		{0x28ce2ea7, {0xef, 0x40,}},  //111.500000,  //40.805399  //0x28ce2ea7
		{0x28d818df, {0xf0, 0x40,}},  //112.000000,  //40.844130  //0x28d818df
		{0x28e1f7c8, {0xf1, 0x40,}},  //112.500000,  //40.882687  //0x28e1f7c8
		{0x28ebcb7d, {0xf2, 0x40,}},  //113.000000,  //40.921074  //0x28ebcb7d
		{0x28f59417, {0xf3, 0x40,}},  //113.500000,  //40.959291  //0x28f59417
		{0x28ff51ae, {0xf4, 0x40,}},  //114.000000,  //40.997340  //0x28ff51ae
		{0x2909045b, {0xf5, 0x40,}},  //114.500000,  //41.035223  //0x2909045b
		{0x2912ac37, {0xf6, 0x40,}},  //115.000000,  //41.072940  //0x2912ac37
		{0x291c4959, {0xf7, 0x40,}},  //115.500000,  //41.110494  //0x291c4959
		{0x2925dbda, {0xf8, 0x40,}},  //116.000000,  //41.147886  //0x2925dbda
		{0x2938e155, {0x85, 0x80,}},  //117.000000,  //41.222188  //0x2938e155
		{0x294bbd5e, {0x86, 0x80,}},  //118.000000,  //41.295858  //0x294bbd5e
		{0x295e70a9, {0x87, 0x80,}},  //119.000000,  //41.368907  //0x295e70a9
		{0x2970fbe4, {0x88, 0x80,}},  //120.000000,  //41.441344  //0x2970fbe4
		{0x29835fba, {0x89, 0x80,}},  //121.000000,  //41.513179  //0x29835fba
		{0x29959cd0, {0x8a, 0x80,}},  //122.000000,  //41.584424  //0x29959cd0
		{0x29a7b3c8, {0x8b, 0x80,}},  //123.000000,  //41.655087  //0x29a7b3c8
		{0x29b9a541, {0x8c, 0x80,}},  //124.000000,  //41.725178  //0x29b9a541
		{0x29cb71d5, {0x8d, 0x80,}},  //125.000000,  //41.794706  //0x29cb71d5
		{0x29dd1a1a, {0x8e, 0x80,}},  //126.000000,  //41.863680  //0x29dd1a1a
		{0x29ee9ea3, {0x8f, 0x80,}},  //127.000000,  //41.932108  //0x29ee9ea3
		{0x2a000000, {0x90, 0x80,}},  //128.000000,  //42.000000  //0x2a000000
};

//*****************************************************************************
//*****************************************************************************
//** Local Functions Declaration
//*****************************************************************************
//*****************************************************************************



//*****************************************************************************
//*****************************************************************************
//** API Functions
//*****************************************************************************
//*****************************************************************************
static int sp2307_get_vblank_time(int handle, GK_Vi_SensorT* sensor_extern, u32* ptime, u32 extclk, u32 pclk)
{
    int                     errorCode       = 0;
    u64                     v_btime;
    //u32                     vertical_lines  = 0;
    u32                     line_length     = 0;

    u32     win_width_h, win_width_l;
    u32     vb_h, vb_l;  //win_height_h, win_height_l;
    u32     vb;

    //page set to 0.
    //sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, 0x1, 1);  //page set to 1.
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_VB_H, &vb_h, 1);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_VB_L, &vb_l, 1);
    vb = (vb_h<<8) + vb_l;
    //vertical_lines = (vb_h<<8) + vb_l + (win_height_h<<8) + win_height_l;
    //BUG_ON(vertical_lines == 0);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_H, &win_width_h, 1);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_L, &win_width_l, 1);
    line_length = (win_width_h<<8) + win_width_l;
    BUG_ON(line_length == 0);

    v_btime = (u64)line_length * (u64)vb * 1000000000;
    // ns
    //if(sensor.vmax_clk_ref == GK_SENSOR_CAL_CLK_PIXCLK_DIV2)
    DO_DIV_ROUND(v_btime, (u64)pclk / 2);

    *ptime = v_btime;

    return errorCode;
}

static int sp2307_set_agc_db(int handle, GK_Vi_SensorT* sensor_extern, s32 agc_db)
{
    int                     errorCode = 0;
    u32                     idc_reg1, idc_reg2;
    u32                     gain_index = SP2307_GAIN_ROWS;
    int                     i;
    GK_Vi_Sensor_SP2307T*   pdata = (GK_Vi_Sensor_SP2307T*)sensor_extern->private_data;
    //printk("[%s %d]%08x\n", __func__, __LINE__, agc_db);

    for(i = 0; i < SP2307_GAIN_ROWS; i++)
    {
        if(SP2307_GLOBAL_GAIN_TABLE[i].db_value > agc_db)
        {
            gain_index = i;
            break;
        }
    }
    if(gain_index>0)
        gain_index--;

    if (gain_index >= SP2307_GAIN_ROWS)
    {
        errorCode = -EINVAL;
        return errorCode;
    }
    //0602 hhl add print
    //printk("hhl add: gain_index=%d \n", gain_index);
    //idc_reg0 = SP2307_GLOBAL_GAIN_TABLE[gain_index].regs.SP2307_REG_FD;
    idc_reg1 = SP2307_GLOBAL_GAIN_TABLE[gain_index].regs.SP2307_REG_24;
    idc_reg2 = SP2307_GLOBAL_GAIN_TABLE[gain_index].regs.SP2307_REG_39;
#ifdef SET_REG_BY_VSYNC
    //pdata->sp2307_reg_fd = idc_reg0;
    pdata->sp2307_reg_24 = idc_reg1;
    pdata->sp2307_reg_39 = idc_reg2;
    pdata->sp2307_adc_ch = 1;
#else
    //0602 hhl add print
    //printk("hhl add: gain: 0x%x  0x%x  0x%x\n", idc_reg1,idc_reg2,idc_reg3);
    //sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, idc_reg0,1);  //page set
    sensor_write_reg_ex(handle, SP2307_REG_ANA_GIAN, idc_reg1,1);  //a_gain
    sensor_write_reg_ex(handle, SP2307_REG_DIG_GIAN, idc_reg2,1);  //d_gain
    sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 1);  //setting enable.
#endif

    return errorCode;
}

static int sp2307_set_shutter_time(int handle, GK_Vi_SensorT* sensor_extern, u32 shutter_time, u32 extclk, u32 pclk)
{
    int     errorCode = 0;
    u64     exposure_time_q9;
    u32     frame_length, line_length;
    u32     win_width_h, win_width_l;
    u32     vb_h, vb_l, win_height_h, win_height_l;
    u32     exp_h, exp_l;
    GK_Vi_Sensor_SP2307T*   pdata = (GK_Vi_Sensor_SP2307T*)sensor_extern->private_data;
    //u8     vts1, vts2;
    //printk("[%s %d]%08x\n", __func__, __LINE__, shutter_time);

    exposure_time_q9 = shutter_time;

    //page set to 0.
    //sensor_write_reg_ex(handle, 0xFD, 0x01,1);  //page set to 1.
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_HEIGHT_H, &win_height_h, 1);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_HEIGHT_L, &win_height_l, 1);
    frame_length = (win_height_h<<8) + win_height_l;

    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_H, &win_width_h, 1);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_L, &win_width_l, 1);
    line_length = (win_width_h<<8) + win_width_l;

    /* t(frame)/t(per line) = t(exposure, in lines)*/
    exposure_time_q9 = exposure_time_q9 * (u64)pclk / 2;// sp2307 spec: Hmax unit : pclk/2
    DO_DIV_ROUND(exposure_time_q9, line_length);
    DO_DIV_ROUND(exposure_time_q9, 512000000);

    if(pdata->fps_set_flag == 1)
    {
        if((frame_length - 4) < exposure_time_q9)
        {
            exposure_time_q9 = frame_length - 4;
        }
        pdata->fps_set_flag = 0;
    }
    else
    {
        if((frame_length - 4) < exposure_time_q9)
        {
            exposure_time_q9 = frame_length - 4;
        }
    }

    exp_h = (exposure_time_q9 >> 8) & 0x0f;
    exp_l = exposure_time_q9 & 0xff;

#ifdef SET_REG_BY_VSYNC
#ifdef SET_SHUTTER_BY_VSYNC
    pdata->sp2307_reg_exp_time_h = exp_h;
    pdata->sp2307_reg_exp_time_l = exp_l;
    pdata->sp2307_shutter_ch = 1;
#else
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_H, exp_h, 1);  //
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_L, exp_l, 1);
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 1);  //setting enable.
#endif
#else
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_H, exp_h, 1);  //
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_L, exp_l, 1);
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 1);  //setting enable.
#endif

    return errorCode;
}

static int sp2307_set_fps(int handle, GK_Vi_SensorT* sensor_extern, u32 fps, u32 extclk, u32 pclk)
{
    int errorCode = 0;
	u32 win_width_h, win_width_l;
    u32 vb_h, vb_l; // win_height_h, win_height_l;
    u32 fps_v = 512000000/fps;
    u32 line_length = 0;
    u32 frame_length = 0;
    u32 sp2307_vb = 0;
    GK_Vi_Sensor_SP2307T*   pdata = (GK_Vi_Sensor_SP2307T*)sensor_extern->private_data;
    //printk("[%s %d]%08x\n", __func__, __LINE__, fps);
    //printk("debug print: fps=%d  pclk=%d \n", fps_v, pclk);

    //page set to 1.
    //sensor_write_reg_ex(handle, 0xFD, 0x01,1);  //page set to 1.

    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_H, &win_width_h, 1);
    errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_WIDTH_L, &win_width_l, 1);

    //line_length = (win_width_h<<8) + win_width_l;  //1182???
    line_length = 1234;

    frame_length = pclk/fps_v/(2*line_length);
	//printk("1226 hhl: %d   %d  %d \n", pclk, fps_v, line_length);

    //errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_HEIGHT_H, &win_height_h, 1);
    //errorCode |= sensor_read_reg_ex(handle, SP2307_REG_WIN_HEIGHT_L, &win_height_l, 1);

    sp2307_vb = frame_length - pdata->fps_frame_len_bak;  //valid_v: 1117.

    vb_h = (sp2307_vb>>8) & 0xff;
    vb_l = sp2307_vb & 0xff;

    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_VB_H, vb_h, 1);  //
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_VB_L, vb_l, 1);
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 1);  //setting enable.

    pdata->fps_set_flag = 1;
    //printk("frame_length: 0x%x  \n", frame_length);

    return errorCode;
}

static int sp2307_set_mirror_mode(int handle, GK_Vi_SensorT* sensor_extern, u32 mirr_mode)
{
    int errorCode = 0;
    GK_Vi_Sensor_SP2307T*   pdata = (GK_Vi_Sensor_SP2307T*)sensor_extern->private_data;

    if(mirr_mode == 0)
    {
        pdata->sp2307_mirror_flip = 0x3;
    }
    else if(mirr_mode == 1)
    {
        pdata->sp2307_mirror_flip = 0x1;
    }
    else if(mirr_mode == 2)
    {
        pdata->sp2307_mirror_flip = 0x2;
    }
    else if(mirr_mode == 3)
    {
        pdata->sp2307_mirror_flip = 0x0;
    }
    else
    {
        return(0);
    }

#ifdef SET_REG_BY_VSYNC
    pdata->sp2307_mirror_need_up = 1;
#else
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, 0x01, 1);
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_MIRROR_FLIP, pdata->sp2307_mirror_flip, 1);
    errorCode |= sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 1);  //setting enable.

    pdata->sp2307_mirror_need_up = 0;
#endif

    return errorCode;
}

static int sp2307_set_update_reg(int handle, GK_Vi_SensorT* sensor_extern)
{
    u32 shutter_chnged =0;
    GK_Vi_Sensor_SP2307T*   pdata = (GK_Vi_Sensor_SP2307T*)sensor_extern->private_data;
    //printk("[%s %d]\n", __func__, __LINE__);

#ifdef SET_REG_BY_VSYNC
#ifdef SET_SHUTTER_BY_VSYNC
    if(pdata->sp2307_shutter_ch == 1)
    {
        //sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, 0x01,0);
        if(pdata->sp2307_last_reg_exp_time_h!=pdata->sp2307_reg_exp_time_h)
        {
            sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_H, pdata->sp2307_reg_exp_time_h,0);
        }
        if(pdata->sp2307_last_reg_exp_time_l!=pdata->sp2307_reg_exp_time_l)
        {
            sensor_write_reg_ex(handle, SP2307_REG_EXP_TIME_L, pdata->sp2307_reg_exp_time_l,0);
        }
		//sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 0);  //setting enable.

        pdata->sp2307_last_reg_exp_time_h = pdata->sp2307_reg_exp_time_h;
        pdata->sp2307_last_reg_exp_time_l = pdata->sp2307_reg_exp_time_l;
        pdata->sp2307_shutter_ch = 0;
        shutter_chnged = 1;
    }
#endif
    if(pdata->sp2307_adc_ch == 1)
    {
        //sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, 0x01, 0);
        if (pdata->sp2307_last_reg_24 != pdata->sp2307_reg_24)
        {
            sensor_write_reg_ex(handle, SP2307_REG_ANA_GIAN, pdata->sp2307_reg_24,0);
        }
        if (pdata->sp2307_last_reg_39 != pdata->sp2307_reg_39)
        {
            sensor_write_reg_ex(handle, SP2307_REG_DIG_GIAN, pdata->sp2307_reg_39,0);
        }
		//sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 0);  //setting enable.

        pdata->sp2307_adc_ch = 0;
        //pdata->sp2307_last_reg_fd = pdata->sp2307_reg_fd;
        pdata->sp2307_last_reg_24 = pdata->sp2307_reg_24;
        pdata->sp2307_last_reg_39 = pdata->sp2307_reg_39;
    }

    if(pdata->sp2307_mirror_need_up == 1)
    {
        //sensor_write_reg_ex(handle, SP2307_REG_PAGE_SET, 0x01, 0);
        sensor_write_reg_ex(handle, SP2307_REG_MIRROR_FLIP, pdata->sp2307_mirror_flip, 0);
		//sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 0);  //setting enable.

        pdata->sp2307_mirror_need_up = 0;
    }
	sensor_write_reg_ex(handle, SP2307_REG_SET_EN, 0x01, 0);  //setting enable.
#endif
    return 0;
}


int sp2307_probe(GK_Vi_SensorT* sensor_extern, int id)
{
    GK_Vi_Sensor_SP2307T * sp2307_data = NULL;

    sensor_extern->private_data = kzalloc(sizeof(GK_Vi_Sensor_SP2307T), GFP_KERNEL);
    if (sensor_extern->private_data == NULL)
    {
        printk("kzalloc memory(0x%04x) failed\n", sizeof(GK_Vi_Sensor_SP2307T));
        return -1;
    }
    sp2307_data = sensor_extern->private_data;

    sp2307_data->sub_id = id;
    #ifdef SET_REG_BY_VSYNC
    sp2307_data->sp2307_adc_ch = 0;
    //.sp2307_reg_fd = 0x01;  //page1
    sp2307_data->sp2307_reg_24 = 0x20;  //agc: 1x: 2x in fact.
    sp2307_data->sp2307_reg_39 = 0x08;  //dgc: 1.0x

    //.sp2307_last_reg_fd = 0xffffffff;
    sp2307_data->sp2307_last_reg_24 = 0xffffffff;
    sp2307_data->sp2307_last_reg_39 = 0xffffffff;

    sp2307_data->sp2307_mirror_need_up  = 0x00;
    sp2307_data->sp2307_crop_ver_l      = 0x02;
    sp2307_data->sp2307_crop_hor_l      = 0x03;
    sp2307_data->sp2307_mirror_flip     = 0x00;

#ifdef SET_SHUTTER_BY_VSYNC

    sp2307_data->sp2307_shutter_ch = 0;
    sp2307_data->sp2307_reg_exp_time_h = 0;
    sp2307_data->sp2307_reg_exp_time_l = 0;

    sp2307_data->sp2307_last_reg_exp_time_h = 0xffffffff;
    sp2307_data->sp2307_last_reg_exp_time_l = 0xffffffff;
#endif
#endif
    sp2307_data->fps_set_flag       = 0;
    sp2307_data->fps_frame_len_bak  = 1117; //default: 30fps   //1361: 25fps  //valid_v alway 1117.

    return 0;
}

int sp2307_remove(GK_Vi_SensorT* sensor_extern)
{
    if (sensor_extern->private_data)
    {
        kfree(sensor_extern->private_data);
        sensor_extern->private_data = NULL;
    }
    return 0;
}

//*****************************************************************************
//*****************************************************************************
//** Local Functions
//*****************************************************************************
//*****************************************************************************
static int __init sp2307_init(void)
{
    sp2307_dev.sensor_id                = GK_VI_SENSOR_SP2307;
    sp2307_dev.length                   = sizeof(sp2307_dev);
    sp2307_dev.private_data             = NULL;
    sp2307_dev.probe                    = sp2307_probe;
    sp2307_dev.remove                   = sp2307_remove;
    sp2307_dev.sensor_get_vblank_time   = sp2307_get_vblank_time;
    sp2307_dev.sensor_set_shutter_time  = sp2307_set_shutter_time;
    sp2307_dev.sensor_set_fps           = sp2307_set_fps;
    sp2307_dev.sensor_set_agc_db        = sp2307_set_agc_db;
    sp2307_dev.sensor_set_mirror_mode   = sp2307_set_mirror_mode;
    sp2307_dev.sensor_set_update_reg    = sp2307_set_update_reg;
    sensor_registry_api(&sp2307_dev);
    return 0;
}

static void __exit sp2307_exit(void)
{
    sensor_unregistry_api(&sp2307_dev);
}

module_init(sp2307_init);
module_exit(sp2307_exit);
MODULE_LICENSE("GPL");
MODULE_AUTHOR("GOKE MICROELECTRONICS Inc.");
MODULE_DESCRIPTION("SP2307 1/6.5-Inch CMOS Digital Image Sensor");

